name: Daily OneSignal Push

on:
  schedule:
    - cron: "42 11 * * *"   # 5:12 PM IST (11:35 UTC)
  workflow_dispatch: {}

jobs:
  send:
    runs-on: ubuntu-latest

    steps:
      - name: Send Notification
        run: |
          payload=$(jq -n \
            --arg app_id "${{ secrets.ONESIGNAL_APP_ID }}" \
            --arg title "${{ secrets.TITLE }}" \
            --arg body "${{ secrets.BODY }}" \
            --arg image "${{ secrets.IMAGE }}" \
            '
            {
              app_id: $app_id,
              included_segments: ["Subscribed Users"],
              headings: { en: $title },
              contents: { en: $body }
            }
            + (if ($image != "") then {
                big_picture: $image,
                ios_attachments: { id: $image }
            } else {} )
          ')

          echo "Sending Notification..."
          curl -i -X POST "https://onesignal.com/api/v1/notifications" \
            -H "Authorization: Basic ${{ secrets.ONESIGNAL_REST_KEY }}" \
            -H "Content-Type: application/json" \
            --data "$payload"

      - name: Done
        run: echo "âœ” Notification sent!"

